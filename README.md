# 課題１：質問に対する回答
## オニオンアーキテクチャの図解

![レイヤードアーキテクチャ](https://qiita-image-store.s3.amazonaws.com/0/192927/a1d81d9b-918e-acdb-987f-56598711e5f5.png)

上記のレイヤードアーキテクチャのインフラ層に「依存性の逆転」を用いてドメイン層およびアプリケーション層から依存される状態からドメイン層およびアプリケーション層に配置されたインターフェースに依存するように変更したものがオニオンアーキテクチャです。


![オニオンアーキテクチャ](https://cdn-ak.f.st-hatena.com/images/fotolife/l/little_hands/20190726/20190726070231.png)

これによってドメイン層はどの層にも依存しなくなるので、ビジネスロジックのみをクリーンに実装できます。

![クラスの種別も含めた図](https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F55214%2F78c97b37-a4b7-f432-6e1f-9b616a5d3a8f.png?ixlib=rb-4.0.0&auto=format&gif-q=60&q=75&s=6fa95466d510c127a573f30983cc3b3d)

さらにドメイン層はドメインサービス層とドメインモデル層に分けられます。

ドメインモデルに配置するドメインオブジェクトは関連する業務データと業務ロジックを１つにまとめたオブジェクトです。
ドメインモデルとは、業務の関心ごとを表現するドメインオブジェクトを集めて体系的に整理したものです。

そのドメインモデルを使用して、ビジネスロジックを実装したものがドメインサービスになります。

![円の図](https://cdn-ak.f.st-hatena.com/images/fotolife/a/ad-sho-loko/20190708/20190708032125.png)

UI層、インフラ層、アプリケーション層、ドメインサービス層、ドメインモデル層を円形にすると上記の様な図になります。
これが玉ねぎの断面に似ていることから、オニオンアーキテクチャと呼ばれています。

## ドメインモデル層が他の層に依存しないことによるメリット

ドメインモデル層が他の層に依存しないことによるメリットは以下の通りです：

* 高い凝集度と低い結合度を達成できるため、保守性と拡張性が向上。
* ドメインモデル以外の層の変更がドメインモデルに影響を与えずに済むため、変更の容易さが向上。
* ビジネスロジックが他の層の技術的な詳細から独立しているため、ドメインモデルが理解しやすくなる。

## 層をまたいだ依存関係はインターフェースに対する依存のみ許可することによるメリット

低い結合度を達成できるため、各層の変更が他の層に影響を与えにくくなる。

## オニオンアーキテクチャにおける「依存性の逆転」の利用

インフラ層がドメイン層やアプリケーション層が持っているインターフェースに依存することで、お互いに実装に対して依存しない様にしている。

## アクセス制限を実装するレイヤー

アクセス制限機能は、アプリケーション層に記述するのが適切だと考えられます。理由は以下の通りです：

* アクセス制限はユースケースの一部であり、アプリケーション層がそれを管理するため。
* アプリケーション層はドメイン層とインフラ層をつなぐ役割を持ち、アクセス制限の情報を取得するために必要なデータにアクセスできるから。
* アクセス制限はドメインモデルやドメインサービスの本質的なビジネスロジックではないため、これらの層には記述しない方が適切であるから。

ただし、ユースケースによってはドメインサービス層に記述することを選択する場合もありえると考えられます。  
これは、アクセス制限が特定のドメインモデルやドメインサービスに密接に関連している場合や、ビジネスルールの一部とみなされる場合です。

## データベースをMySQLからPostgreSQLに変更する場合に影響を受ける層

変更が必要となるのはインフラ層です。インフラ層はデータベースへのアクセスやデータベースとのやり取りを担当するため、データベースの変更が影響を与える層となります。

レポジトリのインターフェースはドメインサービス層で定義されているため、他の層には影響が及ばないように設計されています。

# 課題２：クイズ

オニオンアーキテクチャでは、レポジトリパターンがどのように利用されているか説明してください。

<details>
<summary>回答例</summary>
オニオンアーキテクチャでは、レポジトリパターンがデータアクセスの抽象化と具体的な実装の分離に利用されています。ドメインサービス層では、レポジトリインターフェースが定義され、ドメインモデルとのやりとり(find,saveなど)に使用されます。一方、インフラ層では、具体的なデータアクセス技術（データベースやAPIなど）を用いて、レポジトリインターフェースの実装が行われます。このように、レポジトリパターンを使用することで、ドメインサービス層とインフラ層を疎結合に保ち、技術的な詳細がドメインロジックに影響を与えないようにします。
</details>

オニオンアーキテクチャにおいて、ユーザインターフェース層の主な責務は何でしょうか？

<details>
<summary>回答例</summary>
* ユーザーとのインタラクションを管理し、ユーザーからの入力を受け取ることアプリケーション層に伝達すること
* アプリケーション層から受け取ったデータを適切な形式で表示すること
</details>

オニオンアーキテクチャでのアプリケーション層とドメインサービス層の違いを説明してください。

<details>
<summary>回答例</summary>
オニオンアーキテクチャにおいて、アプリケーション層はユースケースやワークフローを管理する責務があり、ユーザインターフェース層からのリクエストを処理し、適切なドメインサービスやドメインモデルを呼び出してタスクを実行します。一方、ドメインサービス層は、ドメインモデルに属さないが、ビジネスロジックに関連する処理を行う役割があります。ドメインサービス層はドメインモデル層と連携し、ドメインモデルが持つべきでないビジネスロジックを担当することで、ドメインモデルの凝集度を高める役割を果たします。このように、アプリケーション層はユースケースの管理に焦点を当て、ドメインサービス層はビジネスロジックの実装に焦点を当てています。
</details>


# 参考

* https://qiita.com/tozastation/items/a69a102fdc3f62d566b4
* https://zenn.dev/ayumukob/articles/ff183004d09ede
* https://qiita.com/cocoa-maemae/items/e3f2eabbe0877c2af8d0
* https://little-hands.hatenablog.com/entry/2018/12/10/ddd-architecture
* https://buildersbox.corp-sansan.com/entry/2019/07/10/110000